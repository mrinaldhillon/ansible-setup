---
# GNOME Package Installation
- block:
    - name: Install required GNOME packages
      dnf:
        name: "{{ gnome_packages }}"
        state: present
        skip_unavailable: true
      become: true

    # GNOME Settings Deployment
    - name: Backup GNOME settings
      shell: dconf dump / > {{ ansible_env.HOME }}/ogsettings.dconf

    # GNOME Settings Deployment
    - name: Copy GNOME settings file
      copy:
        src: gsettings.dconf
        dest: "/tmp/gsettings.dconf"

    - name: Load GNOME settings using dconf
      shell: dconf load -f / < /tmp/gsettings.dconf

    - name: Update dconf system-wide
      command: dconf update
      become: true
  name: GNOME

- block:
    # 1Password Installation
    - name: Ensure 1Password directory exists
      file:
        path: "{{ onepassword_dir }}"
        state: directory
        mode: "0755"

    - name: Extract 1Password
      unarchive:
        src: "{{ onepassword_url }}"
        dest: "{{ onepassword_dir }}"
        extra_opts: ["--strip-components=1", "--show-stored-names"]
        remote_src: yes

    - name: Run 1Password post-install script
      command: /opt/1Password/after-install.sh
  become: true
  tags: 1password
  name: 1PASSWORD
